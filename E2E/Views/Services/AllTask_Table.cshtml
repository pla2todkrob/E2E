@model E2E.Models.Views.ClsServiceUserActionName

@{
	Layout = null;
}

<table class="display table table-bordered table-hover nowrap w-100">
	<thead>
		<tr>
			<th class="fit">@Html.DisplayNameFor(m => m.services.FirstOrDefault().Update)</th>
			<th class="fit">@Html.DisplayNameFor(m => m.services.FirstOrDefault().System_Statuses.Status_Name)</th>
			<th>@Html.DisplayNameFor(m => m.services.FirstOrDefault().Service_Subject)</th>
			<th class="fit">@Html.DisplayNameFor(m => m.services.FirstOrDefault().Action_User_Id)</th>
			<th class="fit">@Html.DisplayNameFor(m => m.services.FirstOrDefault().Service_EstimateTime)</th>
			<th class="fit">@Html.DisplayNameFor(m => m.services.FirstOrDefault().System_Priorities.Priority_Name)</th>
			<th class="fit">@Html.DisplayNameFor(m => m.services.FirstOrDefault().Service_DueDate)</th>
		</tr>
	</thead>
	<tbody>
		@foreach (var item in Model.services)
		{
			string txtColor = "";
			if (item.Is_OverDue)
			{
				txtColor = "text-danger";
			}
		<tr class="@txtColor">
			<td>@Html.DisplayFor(i => item.Update)</td>
			<td class="text-center"><span class="@item.System_Statuses.Status_Class">@Html.DisplayFor(i => item.System_Statuses.Status_Name)</span></td>
			<td class="text-wrap">
				<small class="font-weight-bold">[@Html.DisplayFor(i => item.Service_Key)]</small><br />
				<a href="@Url.Action("ServiceInfomation", "Services", new { id = item.Service_Id })">@Html.DisplayFor(i => item.Service_Subject)</a>
			</td>

			@{
				string MyName = " ";
				if (Model.serviceChangeDueDates.Any(a => a.Service_Id == item.Service_Id))
				{

					Guid UserChangeDue = Model.serviceChangeDueDates.Where(w => w.Service_Id == item.Service_Id).Select(s => s.User_Id).FirstOrDefault();

					MyName = Model.UserDetails.Where(w => w.User_Id == UserChangeDue).Select(s => s.Detail_EN_FirstName).FirstOrDefault();

					<td class="text-center">@Html.DisplayFor(i => MyName)</td>

				}
				else
				{
					if (item.Action_User_Id.HasValue)
					{
						if (Guid.Equals(item.Action_User_Id.Value, Model.UserId))
						{
							MyName = Model.UserDetails.Where(w => w.User_Id == Model.UserId).Select(s => s.Detail_EN_FirstName).FirstOrDefault();
						}
						else
						{
							MyName = Model.UserDetails.Where(w => w.User_Id == item.Action_User_Id).Select(s => s.Detail_EN_FirstName).FirstOrDefault();
						}
					}
					<td class="text-center">@Html.DisplayFor(i => MyName)</td>
				}

			}

			<td class="text-right">@Html.DisplayFor(i => item.Service_EstimateTime)</td>
			<td class="text-center"><span class="@Html.ValueFor(i => item.System_Priorities.Priority_Class)">@Html.DisplayFor(i => item.System_Priorities.Priority_Name)</span></td>
			<td>@Html.DisplayFor(i => item.Service_DueDate)</td>
		</tr>
		}
	</tbody>
</table>
